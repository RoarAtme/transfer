<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Sharing with Thumbnails</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
        #drop-area { width: 100%; height: 200px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
        #drop-area.dragging { background-color: #f0f0f0; }
        #qr-code { margin-top: 20px; }
        .file-preview {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .file-item {
            position: relative;
            display: inline-block;
            margin: 10px;
        }
        .file-item img {
            max-width: 100px;
            max-height: 100px;
            display: block;
        }
        .file-item .delete-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>File Sharing with Thumbnails</h1>
    <div id="drop-area">
        <p>Drag & Drop files here</p>
    </div>
    <div id="file-preview" class="file-preview"></div>
    <canvas id="qr-code"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script>
        const dropArea = document.getElementById('drop-area');
        const filePreview = document.getElementById('file-preview');

        // Prevent default behavior for drag events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Highlight the drop area when dragging over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('dragging'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragging'), false);
        });

        // Handle the file drop
        dropArea.addEventListener('drop', (e) => {
            let dt = e.dataTransfer;
            let files = dt.files;
            handleFiles(files);
        }, false);

        function handleFiles(files) {
            [...files].forEach(file => {
                previewFile(file);
            });
        }

        function previewFile(file) {
            const reader = new FileReader();
            const fileItem = document.createElement('div');
            fileItem.classList.add('file-item');

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'x';
            deleteButton.classList.add('delete-btn');
            deleteButton.onclick = () => fileItem.remove();

            if (file.type.startsWith('image/')) {
                reader.onloadend = () => {
                    const img = document.createElement('img');
                    img.src = reader.result;
                    fileItem.appendChild(img);
                    fileItem.appendChild(deleteButton);
                    filePreview.appendChild(fileItem);
                };
                reader.readAsDataURL(file);
            } else {
                const defaultIcon = document.createElement('img');
                defaultIcon.src = 'https://via.placeholder.com/100?text=File'; // Placeholder for non-image files
                fileItem.appendChild(defaultIcon);
                fileItem.appendChild(deleteButton);
                filePreview.appendChild(fileItem);
            }
        }

        // QR Code Generation
        const qrCodeElem = document.getElementById('qr-code');
        const myPeerId = Math.random().toString(36).substring(7);
        const link = window.location.href + '?peer=' + myPeerId;

        const qr = new QRious({
            element: qrCodeElem,
            value: link,
            size: 200
        });
    </script>
</body>
</html>
